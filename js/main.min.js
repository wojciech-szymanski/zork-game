var main_data={ROOM_1:{name:"Castle hall",actions:{look:{room:{answer:"It looks like there is some large wardrobe in the corner."},myself:{answer:"Looking good!"}},say:{answer:"%s"},open:{wardrobe:{answer:"Entering Narnia...",next:"ROOM_2"}}}},ROOM_2:{name:"Wardrobe",actions:{run:{answer:"Probably a good idea",next:"ROOM_1"}}}},zorkGame=angular.module("zorkGame",[]);zorkGame.controller("mainCtrl",["$scope","DataSource",function(a,b){a.commands=[],a.command=""}]),zorkGame.directive("runCmd",["DataSource",function(a){return{link:function(b,c,d){c.bind("keypress",function(c){13===c.which&&b.command&&(b.commands.push({command:b.command,answer:a.getAnswer(b.command)}),b.command="")})}}}]).directive("printCmdAnswer",function(){return{template:"<p>&gt;&nbsp;{{cmd.command}}</p><p>{{cmd.answer}}</p>"}}),zorkGame.factory("DataSource",["$http",function(a){return{default_answer:"I am sorry, I do not understand!",current_room:"ROOM_1",data:main_data,getAnswer:function(a){var b=this.data[this.current_room].actions,c=0;if(a=a.split(" "),action=a.shift(),b.hasOwnProperty(action))for(var c=0;c<a.length;c++)b[action].hasOwnProperty(a[c])&&(b=b[action][a[c]]);return b.hasOwnProperty("next")&&(this.current_room=b.next),b.hasOwnProperty("answer")?b.answer.replace(/%s/,a.splice(1).join(" ")):this.default_answer}}}]);